# RailsExam:01 Bugfix

This application contains some bugs for beginner of RoR. 

# How to Setup（課題実施時にこの項目は必ず実施して下さい！）
step1: fork this Repository
- Press fork button  
https://gyazo.com/04e45514f4a9cb64a32168a8a5f34cec  

step2: checkout your branch and run server  
  
`git checkout -b bugfix`  
`bundle install`  
`rails db:create`  
`rails db:migrate`  
`rails db:seed`  
`rails server`  

step3: push your commits and create PullRequest on Github

# How to push commit to Github
`git add .`  
`git commit -m "Fix: [write your message]"`  
`git push origin bugfix`  


# Requirement(Option)

When you fix bugs, write comment `Cause` and `Reason` above your code.  

:en  
`# ErrorCause:　XXX`  
`# FixReason: XXX`  
`your code`  

:jp  
`# エラー原因: XXX`  
`# 修正の意図: XXX`  
`your code`  
```ruby
class Task < ApplicationRecord
  # ErrorCause: Can't use association @task.labels
  # FixReason: Fix typo (label --> labels)
  has_many :labels
end
```

---
### System Versions

* Ruby version  
`3.0.1`

* Rails version  
`6.1`

---
### How to Install Ruby 3.0.1
`brew upgrade rbenv ruby-build`  
`rbenv install 3.0.1`  
`rbenv local 3.0.1`  

---
### Appendix（付録）
下記のGemを導入しています。
1. デバッグ用:5gems
```
gem 'better_errors'
gem 'binding_of_caller'
gem 'pry-rails'
gem 'pry-byebug'
gem 'pry-doc' https://qiita.com/joker1007/items/42f00b12c65bbec0e50a
```
  
2. コード解析用:2gems
```
gem 'rubocop'
gem 'rails_best_practices'
```
`.rubocop.yml` も設定済みです。
こちらの詳細は直接説明致します。

また、Siderなどの解析ツールと連携させるのも良いかもしれません。



1. error: ActionController::RoutingError at /blog
uninitialized constant BlogController

cause: the problem is in Naming blog, they are calling controller blog in route that are not yet created.

reasons: this  is because the controller created with plural name and called with singural name. in ruby route path defined with the same name as the created controller name?

fixcode: we might define blog path like this: resources :blogs do instead of resources :blog do

2. BlogsController#new is missing a template for request formats: text/html

cause: Error occur because we are trying to access new.html.erb file in browser while not yet created. 

reasons: This is because rails expects an action to render a template with the same name contained in a folder after its controller.

fixcode: we need to create file called views/blogs/new.html.erb instead of _new.html.erb

3. 1 error prohibited this blog from being saved:
Content can't be blank

cause: this is because content is required in model  must be present. then our form is not saving content value in database.

reason: this error occurs because content attribute is not listed to the permit method and rails create a new ActiveRecord model, only the permitted attributes are passed to the permit key.

fix: added content attribute to the permit in blogs_controller.rb file.

4. undefined method `comments' for #<Blog:0x00007f5e8c100170>

cause: This error occurs because we are calling  undefined method comments.

reasons: reasons why we defined has_many :comment then we calling comments.

fixcode: defined comments like this: has_many :comments instead of has_many :comment in blog.rb model

5. TypeError at /blogs/11
String can't be coerced into Integer

cause: this is because we add a String to a number. String can't be coerced into Integer usually happens, when you try to add a string to a number.

reason: in ruby cannot add a String to a number. You can add a number to a String, since it is coerced to a String

fixcode: Since I suspect we are counting comment, we should explicitly cast it to string:
    <%= "#{@blog.comments.count.to_i}comments" %>

6. No route matches [GET] "/blogs/11/comments/2"

cause: we did not specify the target of redirect to

reason: rails Redirects the browser to the target specified in options. Then it is missing the id of deleted comment.

fixcode: add the URL will be generated by calling url_for with the options.

def destroy
    @comment = @blog.comments.find(params[:id])
    @comment.destroy
    redirect_to blog_path(@blog)
end

7. undefined method `destroy' for nil:NilClass

cause: This error happens because destroy method is not called to the Callback.

reason: we specicified before_action update, show and  are methods that get called at certain moments of an object's life cycle but we did not specified destroy.

fixcode: before_action :set_blog, only: [:show, :edit, :update, :destroy]

8. SQLite3::ConstraintException: FOREIGN KEY constraint failed

cause: this error displayed while deleting the parent id of other record to dependence table.

reason: this is because the foreing key can not be null.

fixcode: has_many :comments, dependent: :destroy 

9. content field is desplaying only 0 

cause: when you click on show button is displaying 0 to the content.

reason: this is because content has integer datatype while user is entering character.

fixcode: change datatype of integer to the string

10. when clicks on edit button user redirecting to the blog index instead of redirect to the edit page.

cause:  after click on edit button user is redirecting to the wrong setted path 

reason: the define path is for index not for edit

fixcode: <%= link_to 'Edit', edit_blog_path(@blog) %>

11. render form is not displayed to the edit screen 

cause: syntax error <% render 'form', blog: @blog %>

reason: this error happens because we rendered form in wrong way.
fixcode: <%= render 'form', blog: @blog %>

12. we called model in view

cause: <%= form_with(model: Blog.new, local: true) do |form| %>

reason: ruby is MVC. so that view is not responsible to call model. Only controller interact with model and views.

fixcode: <%= form_with(model: blog, local: true) do |form| %>







